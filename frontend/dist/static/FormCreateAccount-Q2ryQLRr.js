import{r as c,_ as H,u as K,b as q,A as z,j as E,P as O}from"./index-BkQICH-X.js";import{z as o,u as G}from"./index.esm-CiJxkhb3.js";const m=[{name:"Account Information",fields:[{name:"email",label:"Email",placeholder:"email@gmail.com",description:"Your email",type:"email"}],validationSchema:o.object({email:o.string().email({message:"Must be a valid email address."})})},{options:!0,name:"Welcome, tell us about yourself",fields:[{name:"option_helper",label:"Find Job",step:1,type:"button"},{name:"option_requester",label:"Find Care",step:1,type:"button"},{name:"option_childcare",label:"Child Care",step:2,type:"button"},{name:"option_seniorcare",label:"Senior Care",step:2,type:"button"},{name:"option_petcare",label:"Pet Care",step:2,type:"button"}],stepsNames:{1:"account_type",2:"preferences"},validationSchema:o.object({option_helper:o.string(),option_requester:o.string(),option_childcare:o.string(),option_seniorcare:o.string(),option_petcare:o.string()})},{name:"Personal Information",fields:[{name:"first_name",label:"First Name",placeholder:"shadcn",description:"Name",step:1},{name:"last_name",label:"Last Name",placeholder:"shadcn",description:"Last Name",step:1},{name:"phone",label:"Phone",placeholder:"1234567890",description:"Your phone number",step:1},{name:"dob",label:"Date of Birth",placeholder:"mm/dd/yyyy",description:"Your date of birth",step:2,type:"date"}],validationSchema:o.object({first_name:o.string().min(5,{message:"First name must be at least 5 characters."}),last_name:o.string().min(5,{message:"Last name must be at least 5 characters."}),phone:o.string(),dob:o.string().min(10,{message:"Date of birth must be in the format mm/dd/yyyy."})}),refineData:[{key:"last_name",func:t=>t.last_name!==t.first_name,message:"First and last name must be different.",path:["last_name"]},{key:"phone",func:t=>t.phone.length===10&&!isNaN(t.phone)||t.phone.length===11,message:"Phone number must be 10 digits.",path:["phone"]},{key:"dob",func:t=>{const f=new Date(t.dob),h=new Date().getFullYear()-f.getFullYear();return h<18?{valid:!1,message:"You must be at least 18 years old."}:h>99?{valid:!1,message:"Are you human?"}:{valid:!0,message:""}},path:["dob"]}]},{name:"Security Information",fields:[{name:"password",label:"Password",placeholder:"password",description:"Your password",step:1,type:"password"},{name:"password2",label:"Password Confirmation",placeholder:"password confirmation",description:"Your password Confirmation",step:1,type:"password"}],validationSchema:o.object({password:o.string().min(6,{message:"Password must be at least 6 characters."}),password2:o.string().min(6,{message:"Password must be at least 6 characters."})}),refineData:[{key:"password2",func:t=>t.password===t.password2,message:"Passwords must match.",path:["password2"]}]}],R=c.lazy(()=>H(()=>import("./MultiForm-CU6d7JVi.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url)),$=m.reduce((t,f)=>(f.fields.forEach(u=>{t[u.name]=""}),t),{});async function J(t,f,u){if(!t)return;const h=await O("/signup",{checkAccount:!0,email:t});if(!h.ok){const j=await h.json();return u({...f,open:!0,message:j.Error}),!1}return(await h.json()).accountExistsAlready?(u({...f,open:!0,message:"An account with this email already exists."}),!1):!0}async function Q(t,f,u){if(!t)return;const h=await O("/signup",{formData:t});if(!h.ok){const n=await h.json();return u({...f,open:!0,message:n.Error}),!1}return await h.json(),!0}const te=()=>{const t=K(),f=q(),{userAuthData:u,setUserAuth:h}=c.useContext(z),[n,j]=c.useState(0),[p,D]=c.useState(1),[w,A]=c.useState({}),[V,U]=c.useState({}),[X,Y]=c.useState(!1),[L,I]=c.useState(null),N=G({defaultValues:$});c.useEffect(()=>{var a,i;if(u&&u.length>0||u&&u.isConnected){t("/");return}const s=(a=f.state)==null?void 0:a.stateOptionsFromHome;s&&console.log(s);const r=(i=f.state)==null?void 0:i.informationGiven;if(r){const _={email:r.email,first_name:r.given_name,last_name:r.family_name};Object.entries(_).forEach(([y,d])=>{N.setValue(y,d),A(b=>({...b,[y]:d}))}),j(1)}return()=>{}},[]);const[T,v]=c.useState(!1),[x,F]=c.useState({open:!1,message:""});c.useEffect(()=>{(async()=>{var r;if(n===m.length){v(!0);const a=await Q(w,x,F);setTimeout(()=>{a?(v(!1),t("/login")):(v(!1),t("/"))},2e3)}else(n>0||p>1)&&((r=m[n])==null?void 0:r.fields.filter(i=>i.step?i.step===p:!0).map(i=>i.name)).forEach(i=>{N.setValue(i,"")})})()},[w]);const W=(s,r)=>{U(a=>{var S;const _=m.filter(e=>e.fields.some(l=>l.step===n)).flatMap(e=>e.fields).filter(e=>e.step===p).map(e=>e.name),y=m.find(e=>e.fields.some(l=>l.step===r)),d=(S=y==null?void 0:y.stepsNames)==null?void 0:S[r];if(!d)return a;const b={...a};return b[d]||(b[d]=[]),b[d]=b[d].filter(e=>e!==s),_.forEach(e=>{b[d].splice(e,1)}),b[d].push(s),b})},k=s=>{var S;const a={...Object.keys(s).filter(e=>!e.includes("option_")).reduce((e,l)=>(e[l]=s[l],e),{}),options:V},i=m[n].fields.filter(e=>e.step?e.step===p:!0);let _=o.object(i.reduce((e,l)=>{var g;return e[l.name]=(g=m[n])==null?void 0:g.validationSchema.shape[l.name],e},{}));(S=m[n])!=null&&S.refineData&&i.forEach(e=>{const l=m[n].refineData.find(g=>g.key===e.name);if(l){const g=l.func(s);let C,P;typeof g=="object"&&g!==null?(C=g.valid,P=g.message):(C=g,P=l.message),_=_.refine(()=>C,{message:P,path:l.path})}});const y=_.safeParse(s);if(!y.success){const e=y.error.formErrors.fieldErrors;I(e);return}const d=m[n].fields.filter(e=>e.step?e.step===p:!0).every(e=>s[e.name]),b=m[n].fields.filter(e=>e.step?e.step===p:!0).some(e=>e.type==="button");(d||b)&&(A(e=>({...e,...a})),m[n].fields.some(e=>e.step===p+1)?D(p+1):(j(n+1),D(1)))},B=async s=>{w.email&&!s.email&&(s.email=w.email);const r=s.email||w.email;if(r&&n===0&&p===1){if(v(!0),!await J(r,x,F)){setTimeout(()=>{v(!1),t("/login")},2e3);return}v(!1),k(s)}else k(s)};c.useEffect(()=>{M()},[n,p]);const M=()=>{var r;const s=(r=m[n])==null?void 0:r.fields.filter(a=>a.step?a.step===p:!0).map(a=>a.name).filter(a=>!a.startsWith("option_"));s&&s.forEach(a=>{const i=w[a];N.setValue(a,i)})};return E.jsx(c.Suspense,{fallback:E.jsx("div",{className:"flex items-center justify-center h-screen",children:E.jsxs("div",{className:"relative",children:[E.jsx("div",{className:"h-24 w-24 rounded-full border-t-8 border-b-8 border-gray-200"}),E.jsx("div",{className:"absolute top-0 left-0 h-24 w-24 rounded-full border-t-8 border-b-8 border-blue-500 animate-spin"})]})}),children:E.jsx(R,{onSubmit:B,handleSetOptionClick:W,setCurrentStep:j,setCurrentSubStep:D,setHasUserNavigatedBack:Y,alertState:x,setAlertState:F,userIsLoading:T,currentStep:n,currentSubStep:p,formSteps:m,form:N,formData:w,errors:L})})};export{te as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./MultiForm-CU6d7JVi.js","./index-BkQICH-X.js","./index-BjR-M_RL.css","./Notifications-KuRf63x_.js","./iconBase-r11lJbk7.js","./extends-CCbyfPlC.js","./index-BDpOC3Tw.js","./index.esm-CiJxkhb3.js","./label-HHLXxaTW.js","./createLucideIcon-CFD14ua0.js","./index-CTZesL8v.js","./button-DZFmWa-B.js","./card-DD6vI8e8.js","./input-DfNpMjP5.js","./index-BBjFYfzN.js","./check-CvClZA8D.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
