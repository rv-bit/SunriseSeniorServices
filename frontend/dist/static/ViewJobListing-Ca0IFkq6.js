import{r as i,A as I,u as _,b as D,P as T,j as e,R as A,G as b,h as E}from"./index-BkQICH-X.js";import{B as w}from"./button-DZFmWa-B.js";import{b as $}from"./index-DVM--Iqe.js";import{u as B}from"./UseDocumentTitle-McNeP1rR.js";import{N as P}from"./Notifications-KuRf63x_.js";import"./index-BDpOC3Tw.js";import"./extends-CCbyfPlC.js";import"./iconBase-r11lJbk7.js";const K=()=>{B("View Job Listing");const{userAuthData:m}=i.useContext(I),o=_(),y=D(),c=new URLSearchParams(y.search).get("currentJobId"),[t,N]=i.useState({}),[U,g]=i.useState(!1),[l,n]=i.useState({open:!1,message:""}),v=(s,a)=>{s.preventDefault(),o(`/job-listings?currentJobId=${a}`)},[j,h]=i.useState(!1),k=i.useCallback(async s=>{const a=await T("/createChat",{data:{id:s,members:[m._id,t.user_id],name:t.title}});if(!a.ok){const u=await a.json();return n({...l,open:!0,message:u.Error}),!1}const r=await a.json();if(r.chatExists)return n({...l,open:!0,message:"Chat already exists, moving to the chat"}),!0;if(r.Success)return!0}),x=async(s,a)=>{if(s.preventDefault(),m==null)o("/login",{state:{info:"You must be logged in to send a message!"}});else{h(!0);const r=a+m._id+t.user_id;if(!await k(r))return setTimeout(()=>{h(!1)},2500);setTimeout(()=>{h(!1),s.altKey&&s.type==="click"||s.type==="auxclick"?handleOpenInNewTab(s,`/chat?currentChatId=${r}`):window.innerWidth<1180?o(`/chat?currentChatId=${r}`):o(`/chat?currentChatId=${r}`)},2500)}};return i.useEffect(()=>((async()=>{g(!0);const a=await b(`/getJobListingById?currentJobIdFromSearch=${c}`);if(!a.ok){const d=await a.json();if(d.Error){n({...l,open:!0,message:d.Error}),o("/job-listings");return}n({...l,open:!0,message:"An error occurred while trying to fetch the job"});return}const r=await a.json(),u=E(r.tags);var f=r.posted_at.split("-"),C=f[2]+"/"+f[1]+"/"+f[0];const p=await b(`/getUserByIdForJobListing?user_id=${r.user_id}`);if(!p.ok){const d=await p.json();if(d.Error){o("/job-listings"),n({...l,open:!0,message:d.Error});return}n({...l,open:!0,message:"An error occurred while trying to fetch the user"});return}const S=await p.json(),J={...r,tags:u,posted_at:C,person:S.name};g(!1),N(J)})(),c||o("/job-listings"),()=>{}),[]),e.jsxs(A.Fragment,{children:[l.open&&e.jsx(P,{alertState:l,setAlertState:n}),e.jsx("hr",{className:"w-full opacity-30 border-t border-slate-400"}),e.jsx("div",{className:"flex items-center justify-center w-full h-full gap-2 my-10 px-10 max-extraSm:px-0",children:e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsxs("div",{className:"flex justify-center flex-row w-full h-full",children:[e.jsxs("div",{className:"flex flex-col gap-3 w-full lg:w-[500px] md:w-3/4 max-extraSm:w-10/12",children:[e.jsxs("span",{onClick:s=>v(s,c),className:"flex items-center gap-1 -mt-5 hover:underline hover:cursor-pointer",children:[e.jsx($,{size:15}),e.jsx("h1",{children:"Go Back"})]}),e.jsxs("div",{className:"w-full inline-block whitespace-normal break-words",children:[e.jsx("h1",{className:"text-xl max-lg:text-2xl lg:text-3xl font-bold text-slate-900",children:t==null?void 0:t.title}),e.jsx("p",{className:"text-slate-600 text-opacity-75 mt-3",children:t==null?void 0:t.location}),e.jsx("div",{className:"lg:hidden md:block sm:block extraSm:block max-extraSm:block",children:e.jsx("div",{className:"flex justify-start mt-5",children:e.jsx(w,{disabled:j,onClick:s=>x(s,c),onAuxClick:s=>x(s,c),className:"w-[300px] bg-[#d06139c5] bg-opacity-80 hover:bg-[#e8432dea]",children:"Message"})})}),e.jsxs("div",{className:"mt-5",children:[e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:"Full Job Description"}),e.jsx("p",{className:"font-normal text-slate-600",children:t==null?void 0:t.description})]}),e.jsx("div",{className:"lg:hidden md:block sm:block extraSm:block max-extraSm:block",children:e.jsx("div",{className:"flex my-5 w-full h-full",children:e.jsx("div",{role:"tags",className:"grid grid-flow-row-dense extraSm:grid-cols-3 max-extraSm:grid-cols-3 sm:grid-cols-5 md:grid-cols-7 items-center mt-2 gap-1 text-center text-black text-opacity-70 group-hover:text-opacity-90",children:t!=null&&t.tags&&typeof t.tags=="object"?Object.entries(t.tags).filter(([s,a])=>a!==""&&s.startsWith("Tag_")).map(([s,a],r)=>e.jsx("div",{className:"bg-slate-100 px-2 py-2 h-full rounded-md text-ellipsis overflow-hidden flex items-center justify-center",children:e.jsx("p",{className:"text-sm",children:a})},r)):null})})}),e.jsxs("p",{className:"my-5 text-slate-600 text-opacity-75",children:["Posted by ",e.jsx("span",{className:"text-slate-900 underline",children:t==null?void 0:t.person})]}),e.jsx("div",{className:"mt-5",children:e.jsxs("p",{className:"text-slate-600 text-opacity-75",children:["Posted on ",e.jsx("span",{className:"text-slate-900",children:t==null?void 0:t.posted_at})]})}),e.jsx("hr",{className:"mt-10 w-full opacity-30 border-t border-slate-400"}),(t==null?void 0:t.additional_information)!==""&&e.jsxs("div",{className:"mt-5",children:[e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:"Additional Information"}),e.jsx("p",{className:"font-normal text-slate-600",children:t==null?void 0:t.additional_information})]})]})]}),e.jsx("div",{className:"hidden lg:flex md:hidden sm:hidden extraSm:hidden max-extraSm:hidden",children:e.jsxs("div",{className:"ml-32 w-[300px]",children:[e.jsx(w,{disabled:j,onClick:s=>x(s,c),onAuxClick:s=>x(s,c),className:"w-full mt-5 bg-[#d06139c5] bg-opacity-80 hover:bg-[#e8432dea]",children:"Message"}),e.jsx("div",{className:"flex items-center justify-center mt-5",children:e.jsx("div",{role:"tags",className:"grid grid-flow-row-dense grid-cols-3 items-center mt-2 gap-1 text-center text-black text-opacity-70 group-hover:text-opacity-90",children:t!=null&&t.tags&&typeof t.tags=="object"?Object.entries(t.tags).filter(([s,a])=>a!==""&&s.startsWith("Tag_")).map(([s,a],r)=>e.jsx("div",{className:"bg-slate-100 px-2 py-2 h-full rounded-md text-ellipsis overflow-hidden flex items-center justify-center",children:e.jsx("p",{className:"text-sm",children:a})},r)):null})})]})})]})})})]})};export{K as default};
